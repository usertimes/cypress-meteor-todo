{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/idrismahjoubi/cypress-meteor-react/packages/react-meteor-data/useTracker.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/react-meteor-data/useTracker.ts","filename":"/Users/idrismahjoubi/cypress-meteor-react/packages/react-meteor-data/useTracker.ts","inputSourceMap":{"version":3,"file":"packages/react-meteor-data/useTracker.ts","sourceRoot":"","sources":["packages/react-meteor-data/useTracker.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,gBAAgB,CAAC;AACzC,OAAO,EAAE,UAAU,EAAE,SAAS,EAAE,MAAM,EAAE,OAAO,EAAkB,MAAM,OAAO,CAAC;AAE/E,uEAAuE;AACvE,SAAS,WAAW,CAAE,IAAS;IAC7B,IAAI,UAAU,GAAG,KAAK,CAAC;IACvB,IAAI,OAAO,CAAC,KAAK,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,IAAI,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;QAC5E,IAAI,IAAI,YAAY,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE;YAC9C,UAAU,GAAG,IAAI,CAAC;SACnB;aAAM,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,MAAM,CAAC,SAAS,EAAE;YAC3D,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;gBAChC,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE;oBACnD,UAAU,GAAG,IAAI,CAAC;iBACnB;YACH,CAAC,CAAC,CAAC;SACJ;KACF;IACD,IAAI,UAAU,EAAE;QACd,OAAO,CAAC,IAAI,CACV,+DAA+D;cAC7D,6DAA6D;cAC7D,+CAA+C,CAClD,CAAC;KACH;AACH,CAAC;AAED,iEAAiE;AACjE,iEAAiE;AACjE,MAAM,GAAG,GAAG,CAAC,CAAS,EAAU,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;AACzC,MAAM,cAAc,GAAG,GAAG,EAAE,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAgBnD,MAAM,gBAAgB,GAAG,CAAU,UAA0B,EAAE,aAA6B,IAAI,EAAE,EAAE;IAClG,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,CAAc;QAC5C,SAAS,EAAE,KAAK;QAChB,WAAW,EAAE,IAAI;KAClB,CAAC,CAAC;IACH,MAAM,WAAW,GAAG,cAAc,EAAE,CAAC;IAErC,+EAA+E;IAC/E,IAAI,IAAI,CAAC,WAAW,EAAE;QACpB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;QACxB,gEAAgE;QAChE,OAAO,IAAI,CAAC,WAAW,CAAC;KACzB;IAED,uEAAuE;IACvE,2EAA2E;IAC3E,oEAAoE;IACpE,kEAAkE;IAClE,0BAA0B;IAC1B,OAAO,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAsB,EAAE,EAAE;QACnE,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,CAAC,QAAQ,EAAE;YACd,wCAAwC;YACxC,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;SAClC;aAAM,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE;YACtE,wFAAwF;YACxF,WAAW,EAAE,CAAC;SACf;IACH,CAAC,CAAC,CAAC,CAAC;IAEJ,4EAA4E;IAC5E,2FAA2F;IAC3F,0FAA0F;IAC1F,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;QACnB,6DAA6D;QAC7D,2DAA2D;QAC3D,IAAI,IAAI,CAAC,WAAW,EAAE;YACpB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YACxB,OAAO,IAAI,CAAC,WAAW,CAAC;SACzB;KACF;IAED,SAAS,CAAC,GAAG,EAAE;QACb,oEAAoE;QACpE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QAEtB,gFAAgF;QAChF,gEAAgE;QAChE,IAAI,CAAC,UAAU,EAAE;YACf,WAAW,EAAE,CAAC;SACf;aAAM;YACL,OAAO,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAsB,EAAE,EAAE;gBACnE,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;gBACrB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE;oBAChD,wFAAwF;oBACxF,WAAW,EAAE,CAAC;iBACf;YACH,CAAC,CAAC,CAAC,CAAC;SACL;QAED,kCAAkC;QAClC,OAAO,GAAG,EAAE;YACV,IAAI,CAAC,WAAW,EAAE,IAAI,EAAE,CAAC;QAC3B,CAAC,CAAA;IACH,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,OAAO,IAAI,CAAC,WAAW,CAAC;AAC1B,CAAC,CAAA;AAED,MAAM,kBAAkB,GAAG,CAAU,UAA0B,EAAE,IAAoB,EAAE,aAA6B,IAAI,EAAK,EAAE;IAC7H,MAAM,WAAW,GAAG,cAAc,EAAE,CAAC;IAErC,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,CAG7B,EAAE,UAAU,EAAE,CAAC,CAAC;IAEnB,4BAA4B;IAC5B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;IAE7B,OAAO,CAAC,GAAG,EAAE;QACX,0EAA0E;QAC1E,0EAA0E;QAC1E,MAAM,IAAI,GAAG,OAAO,CAAC,WAAW,CAC9B,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAsB,EAAE,EAAE;YAC/C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAChC,CAAC,CAAC,CACH,CAAC;QACF,6EAA6E;QAC7E,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,IAAI,EAAE,CAAA,CAAC,CAAC,CAAC,CAAC;IACtC,CAAC,EAAE,IAAI,CAAC,CAAC;IAET,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,WAAW,GAAG,OAAO,CAAC,WAAW,CACrC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE;YAC1B,MAAM,IAAI,GAAM,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACnC,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE;gBAC/C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjB,WAAW,EAAE,CAAC;aACf;QACH,CAAC,CAAC,CACH,CAAC;QACF,OAAO,GAAG,EAAE;YACV,WAAW,CAAC,IAAI,EAAE,CAAC;QACrB,CAAC,CAAC;IACJ,CAAC,EAAE,IAAI,CAAC,CAAC;IAET,OAAO,IAAI,CAAC,IAAS,CAAC;AACxB,CAAC,CAAC;AAIF,SAAS,gBAAgB,CAAW,UAA0B,EAAE,OAAwC,IAAI,EAAE,aAA6B,IAAI;IAC7I,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,KAAK,SAAS,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QAC/D,IAAI,OAAO,IAAI,KAAK,UAAU,EAAE;YAC9B,UAAU,GAAG,IAAI,CAAC;SACnB;QACD,OAAO,gBAAgB,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;KACjD;SAAM;QACL,OAAO,kBAAkB,CAAC,UAAU,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;KACzD;AACH,CAAC;AAED,MAAM,gBAAgB,GAA4B,CAAC,UAAU,EAAE,EAAE;IAC/D,OAAO,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;AACzC,CAAC,CAAA;AAED,kEAAkE;AAClE,iFAAiF;AACjF,MAAM,UAAU,GAAG,MAAM,CAAC,QAAQ;IAChC,CAAC,CAAC,gBAAgB;IAClB,CAAC,CAAC,gBAAgB,CAAC;AAErB,SAAS,aAAa,CAAE,UAAU,EAAE,IAAI,GAAG,IAAI,EAAE,UAAU,GAAG,IAAI;IAChE,SAAS,IAAI,CAAE,OAAe,EAAE,GAAW,EAAE,GAAW,EAAE,IAAY;QACpE,OAAO,CAAC,IAAI,CACV,kCAAkC,OAAO,aAAa,GAAG,YAAY;cACjE,IAAI,GAAG,wBAAwB,IAAI,KAAK,CAC7C,CAAC;IACJ,CAAC;IAED,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;QACpC,IAAI,CAAC,UAAU,EAAE,KAAK,EAAE,YAAY,EAAE,UAAU,CAAC,CAAC;KACnD;IAED,IAAI,IAAI,IAAI,UAAU,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;QAClF,IAAI,CAAC,kBAAkB,EAAE,aAAa,EAAE,kBAAkB,EACxD,GAAG,OAAO,IAAI,MAAM,OAAO,UAAU,EAAE,CAAC,CAAC;KAC5C;SAAM;QACL,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,OAAO,IAAI,KAAK,UAAU,EAAE;YAC9D,IAAI,CAAC,mBAAmB,EAAE,KAAK,EAAE,oBAAoB,EAAE,OAAO,IAAI,CAAC,CAAC;SACrE;QACD,IAAI,UAAU,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;YAClD,IAAI,CAAC,UAAU,EAAE,KAAK,EAAE,YAAY,EAAE,OAAO,UAAU,CAAC,CAAC;SAC1D;KACF;IAED,MAAM,IAAI,GAAG,UAAU,CAAC,UAAU,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;IACtD,WAAW,CAAC,IAAI,CAAC,CAAC;IAClB,OAAO,IAAI,CAAC;AACd,CAAC;AAED,eAAe,MAAM,CAAC,aAAa;IACjC,CAAC,CAAC,aAAwC;IAC1C,CAAC,CAAC,UAAU,CAAC","sourcesContent":["declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo, DependencyList } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor (data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nexport interface IReactiveFn<T> {\n  <T>(c?: Tracker.Computation): T\n}\n\nexport interface ISkipUpdate<T> {\n  <T>(prev: T, next: T): boolean\n}\n\ntype TrackerRefs = {\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  trackerData: any;\n}\n\nconst useTrackerNoDeps = <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate: ISkipUpdate<T> = null) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = reactiveFn(c);\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, reactiveFn(c))) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  }));\n\n  // To avoid creating side effects in render with Tracker when not using deps\n  // create the computation, run the user's reactive function in a computation synchronously,\n  // then immediately dispose of it. It'll be recreated again after the render is committed.\n  if (!refs.isMounted) {\n    // We want to forceUpdate in useEffect to support StrictMode.\n    // See: https://github.com/meteor/react-packages/issues/278\n    if (refs.computation) {\n      refs.computation.stop();\n      delete refs.computation;\n    }\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    // Render is committed. Since useTracker without deps always runs synchronously,\n    // forceUpdate and let the next render recreate the computation.\n    if (!skipUpdate) {\n      forceUpdate();\n    } else {\n      Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n        refs.computation = c;\n        if (!skipUpdate(refs.trackerData, reactiveFn(c))) {\n          // For any reactive change, forceUpdate and let the next render rebuild the computation.\n          forceUpdate();\n        }\n      }));\n    }\n\n    // stop the computation on unmount\n    return () =>{\n      refs.computation?.stop();\n    }\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps = <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList, skipUpdate: ISkipUpdate<T> = null): T => {\n  const forceUpdate = useForceUpdate();\n\n  const { current: refs } = useRef<{\n    reactiveFn: IReactiveFn<T>;\n    data?: T;\n  }>({ reactiveFn });\n\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(\n      () => Tracker.autorun((c: Tracker.Computation) => {\n        refs.data = refs.reactiveFn();\n      })\n    );\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(() => { comp.stop() });\n  }, deps);\n\n  useEffect(() => {\n    const computation = Tracker.nonreactive(\n      () => Tracker.autorun((c) => {\n        const data: T = refs.reactiveFn(c);\n        if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      })\n    );\n    return () => {\n      computation.stop();\n    };\n  }, deps);\n\n  return refs.data as T;\n};\n\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps?: DependencyList, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList | ISkipUpdate<T> = null, skipUpdate: ISkipUpdate<T> = null): T {\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer: typeof useTrackerClient = (reactiveFn) => {\n  return Tracker.nonreactive(reactiveFn);\n}\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nfunction useTrackerDev (reactiveFn, deps = null, skipUpdate = null) {\n  function warn (expects: string, pos: string, arg: string, type: string) {\n    console.warn(\n      `Warning: useTracker expected a ${expects} in it\\'s ${pos} argument `\n        + `(${arg}), but got type of \\`${type}\\`.`\n    );\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\",\n      `${typeof deps} & ${typeof skipUpdate}`);\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nexport default Meteor.isDevelopment\n  ? useTrackerDev as typeof useTrackerClient\n  : useTracker;\n"]},"targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"test","cwd":"/Users/idrismahjoubi/cypress-meteor-react","root":"/Users/idrismahjoubi/cypress-meteor-react","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/idrismahjoubi/cypress-meteor-react/packages/react-meteor-data/useTracker.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/react-meteor-data/useTracker.ts"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 1);\nlet useReducer, useEffect, useRef, useMemo;\nmodule.link(\"react\", {\n  useReducer(v) {\n    useReducer = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useRef(v) {\n    useRef = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  }\n\n}, 2);\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor(data) {\n  let shouldWarn = false;\n\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach(key => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n\n  if (shouldWarn) {\n    console.warn('Warning: your reactive function is returning a Mongo cursor. ' + 'This value will not be reactive. You probably want to call ' + '`.fetch()` on the cursor before returning it.');\n  }\n} // Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\n\n\nconst fur = x => x + 1;\n\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nconst useTrackerNoDeps = function (reactiveFn) {\n  let skipUpdate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  const {\n    current: refs\n  } = useRef({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate(); // Without deps, always dispose and recreate the computation with every render.\n\n  if (refs.computation) {\n    refs.computation.stop(); // @ts-ignore This makes TS think ref.computation is \"never\" set\n\n    delete refs.computation;\n  } // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n\n\n  Tracker.nonreactive(() => Tracker.autorun(c => {\n    refs.computation = c;\n\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = reactiveFn(c);\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, reactiveFn(c))) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  })); // To avoid creating side effects in render with Tracker when not using deps\n  // create the computation, run the user's reactive function in a computation synchronously,\n  // then immediately dispose of it. It'll be recreated again after the render is committed.\n\n  if (!refs.isMounted) {\n    // We want to forceUpdate in useEffect to support StrictMode.\n    // See: https://github.com/meteor/react-packages/issues/278\n    if (refs.computation) {\n      refs.computation.stop();\n      delete refs.computation;\n    }\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true; // Render is committed. Since useTracker without deps always runs synchronously,\n    // forceUpdate and let the next render recreate the computation.\n\n    if (!skipUpdate) {\n      forceUpdate();\n    } else {\n      Tracker.nonreactive(() => Tracker.autorun(c => {\n        refs.computation = c;\n\n        if (!skipUpdate(refs.trackerData, reactiveFn(c))) {\n          // For any reactive change, forceUpdate and let the next render rebuild the computation.\n          forceUpdate();\n        }\n      }));\n    } // stop the computation on unmount\n\n\n    return () => {\n      var _refs$computation;\n\n      (_refs$computation = refs.computation) === null || _refs$computation === void 0 ? void 0 : _refs$computation.stop();\n    };\n  }, []);\n  return refs.trackerData;\n};\n\nconst useTrackerWithDeps = function (reactiveFn, deps) {\n  let skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  const forceUpdate = useForceUpdate();\n  const {\n    current: refs\n  } = useRef({\n    reactiveFn\n  }); // keep reactiveFn ref fresh\n\n  refs.reactiveFn = reactiveFn;\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(() => Tracker.autorun(c => {\n      refs.data = refs.reactiveFn();\n    })); // To avoid creating side effects in render, stop the computation immediately\n\n    Meteor.defer(() => {\n      comp.stop();\n    });\n  }, deps);\n  useEffect(() => {\n    const computation = Tracker.nonreactive(() => Tracker.autorun(c => {\n      const data = refs.reactiveFn(c);\n\n      if (!skipUpdate || !skipUpdate(refs.data, data)) {\n        refs.data = data;\n        forceUpdate();\n      }\n    }));\n    return () => {\n      computation.stop();\n    };\n  }, deps);\n  return refs.data;\n};\n\nfunction useTrackerClient(reactiveFn) {\n  let deps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  let skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer = reactiveFn => {\n  return Tracker.nonreactive(reactiveFn);\n}; // When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\n\n\nconst useTracker = Meteor.isServer ? useTrackerServer : useTrackerClient;\n\nfunction useTrackerDev(reactiveFn) {\n  let deps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  let skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  function warn(expects, pos, arg, type) {\n    console.warn(\"Warning: useTracker expected a \".concat(expects, \" in it's \").concat(pos, \" argument \") + \"(\".concat(arg, \"), but got type of `\").concat(type, \"`.\"));\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\", \"\".concat(typeof deps, \" & \").concat(typeof skipUpdate));\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nmodule.exportDefault(Meteor.isDevelopment ? useTrackerDev : useTracker);","map":{"version":3,"sources":["packages/react-meteor-data/useTracker.ts"],"names":[],"mappings":"AACA,IAAA,MAAA;AAAS,MAAQ,CAAA,IAAR,CAAc,eAAd,EAA8B;AAAA,EAAA,MAAA,CAAA,CAAA,EAAA;AAAA,IAAA,MAAA,GAAA,CAAA;AAAA;;AAAA,CAA9B,EAA8B,CAA9B;AAA8B,IAAA,OAAA;AAAA,MAAA,CAAA,IAAA,CAAA,gBAAA,EAAA;AAAA,EAAA,OAAA,CAAA,CAAA,EAAA;AAAA,IAAA,OAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,UAAA,EAAA,SAAA,EAAA,MAAA,EAAA,OAAA;AAAA,MAAA,CAAA,IAAA,CAAA,OAAA,EAAA;AAAA,EAAA,UAAA,CAAA,CAAA,EAAA;AAAA,IAAA,UAAA,GAAA,CAAA;AAAA,GAAA;;AAAA,EAAA,SAAA,CAAA,CAAA,EAAA;AAAA,IAAA,SAAA,GAAA,CAAA;AAAA,GAAA;;AAAA,EAAA,MAAA,CAAA,CAAA,EAAA;AAAA,IAAA,MAAA,GAAA,CAAA;AAAA,GAAA;;AAAA,EAAA,OAAA,CAAA,CAAA,EAAA;AAAA,IAAA,OAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;;AAIvC;AACA,SAAS,WAAT,CAAsB,IAAtB,EAA+B;AAC7B,MAAI,UAAU,GAAG,KAAjB;;AACA,MAAI,OAAO,CAAC,KAAR,IAAiB,OAAO,CAAC,KAAR,CAAc,KAA/B,IAAwC,IAAxC,IAAgD,OAAO,IAAP,KAAgB,QAApE,EAA8E;AAC5E,QAAI,IAAI,YAAY,OAAO,CAAC,KAAR,CAAc,KAAd,CAAoB,MAAxC,EAAgD;AAC9C,MAAA,UAAU,GAAG,IAAb;AACD,KAFD,MAEO,IAAI,MAAM,CAAC,cAAP,CAAsB,IAAtB,MAAgC,MAAM,CAAC,SAA3C,EAAsD;AAC3D,MAAA,MAAM,CAAC,IAAP,CAAY,IAAZ,EAAkB,OAAlB,CAA2B,GAAD,IAAQ;AAChC,YAAI,IAAI,CAAC,GAAD,CAAJ,YAAqB,OAAO,CAAC,KAAR,CAAc,KAAd,CAAoB,MAA7C,EAAqD;AACnD,UAAA,UAAU,GAAG,IAAb;AACD;AACF,OAJD;AAKD;AACF;;AACD,MAAI,UAAJ,EAAgB;AACd,IAAA,OAAO,CAAC,IAAR,CACE,kEACE,6DADF,GAEE,+CAHJ;AAKD;AACF,C,CAED;AACA;;;AACA,MAAM,GAAG,GAAI,CAAD,IAAuB,CAAC,GAAG,CAAvC;;AACA,MAAM,cAAc,GAAG,MAAM,UAAU,CAAC,GAAD,EAAM,CAAN,CAAV,CAAmB,CAAnB,CAA7B;;AAgBA,MAAM,gBAAgB,GAAG,UAAU,UAAV,EAA2E;AAAA,MAArC,UAAqC,uEAAR,IAAQ;AAClG,QAAM;AAAE,IAAA,OAAO,EAAE;AAAX,MAAoB,MAAM,CAAc;AAC5C,IAAA,SAAS,EAAE,KADiC;AAE5C,IAAA,WAAW,EAAE;AAF+B,GAAd,CAAhC;AAIA,QAAM,WAAW,GAAG,cAAc,EAAlC,CALkG,CAOlG;;AACA,MAAI,IAAI,CAAC,WAAT,EAAsB;AACpB,IAAA,IAAI,CAAC,WAAL,CAAiB,IAAjB,GADoB,CAEpB;;AACA,WAAO,IAAI,CAAC,WAAZ;AACD,GAZiG,CAclG;AACA;AACA;AACA;AACA;;;AACA,EAAA,OAAO,CAAC,WAAR,CAAoB,MAAM,OAAO,CAAC,OAAR,CAAiB,CAAD,IAA2B;AACnE,IAAA,IAAI,CAAC,WAAL,GAAmB,CAAnB;;AACA,QAAI,CAAC,CAAC,QAAN,EAAgB;AACd;AACA,MAAA,IAAI,CAAC,WAAL,GAAmB,UAAU,CAAC,CAAD,CAA7B;AACD,KAHD,MAGO,IAAI,CAAC,UAAD,IAAe,CAAC,UAAU,CAAC,IAAI,CAAC,WAAN,EAAmB,UAAU,CAAC,CAAD,CAA7B,CAA9B,EAAiE;AACtE;AACA,MAAA,WAAW;AACZ;AACF,GATyB,CAA1B,EAnBkG,CA8BlG;AACA;AACA;;AACA,MAAI,CAAC,IAAI,CAAC,SAAV,EAAqB;AACnB;AACA;AACA,QAAI,IAAI,CAAC,WAAT,EAAsB;AACpB,MAAA,IAAI,CAAC,WAAL,CAAiB,IAAjB;AACA,aAAO,IAAI,CAAC,WAAZ;AACD;AACF;;AAED,EAAA,SAAS,CAAC,MAAK;AACb;AACA,IAAA,IAAI,CAAC,SAAL,GAAiB,IAAjB,CAFa,CAIb;AACA;;AACA,QAAI,CAAC,UAAL,EAAiB;AACf,MAAA,WAAW;AACZ,KAFD,MAEO;AACL,MAAA,OAAO,CAAC,WAAR,CAAoB,MAAM,OAAO,CAAC,OAAR,CAAiB,CAAD,IAA2B;AACnE,QAAA,IAAI,CAAC,WAAL,GAAmB,CAAnB;;AACA,YAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAN,EAAmB,UAAU,CAAC,CAAD,CAA7B,CAAf,EAAkD;AAChD;AACA,UAAA,WAAW;AACZ;AACF,OANyB,CAA1B;AAOD,KAhBY,CAkBb;;;AACA,WAAO,MAAK;AAAA;;AACV,2BAAA,IAAI,CAAC,WAAL,wEAAkB,IAAlB;AACD,KAFD;AAGD,GAtBQ,EAsBN,EAtBM,CAAT;AAwBA,SAAO,IAAI,CAAC,WAAZ;AACD,CAnED;;AAqEA,MAAM,kBAAkB,GAAG,UAAU,UAAV,EAAsC,IAAtC,EAAoG;AAAA,MAAxC,UAAwC,uEAAX,IAAW;AAC7H,QAAM,WAAW,GAAG,cAAc,EAAlC;AAEA,QAAM;AAAE,IAAA,OAAO,EAAE;AAAX,MAAoB,MAAM,CAG7B;AAAE,IAAA;AAAF,GAH6B,CAAhC,CAH6H,CAQ7H;;AACA,EAAA,IAAI,CAAC,UAAL,GAAkB,UAAlB;AAEA,EAAA,OAAO,CAAC,MAAK;AACX;AACA;AACA,UAAM,IAAI,GAAG,OAAO,CAAC,WAAR,CACX,MAAM,OAAO,CAAC,OAAR,CAAiB,CAAD,IAA2B;AAC/C,MAAA,IAAI,CAAC,IAAL,GAAY,IAAI,CAAC,UAAL,EAAZ;AACD,KAFK,CADK,CAAb,CAHW,CAQX;;AACA,IAAA,MAAM,CAAC,KAAP,CAAa,MAAK;AAAG,MAAA,IAAI,CAAC,IAAL;AAAa,KAAlC;AACD,GAVM,EAUJ,IAVI,CAAP;AAYA,EAAA,SAAS,CAAC,MAAK;AACb,UAAM,WAAW,GAAG,OAAO,CAAC,WAAR,CAClB,MAAM,OAAO,CAAC,OAAR,CAAiB,CAAD,IAAM;AAC1B,YAAM,IAAI,GAAM,IAAI,CAAC,UAAL,CAAgB,CAAhB,CAAhB;;AACA,UAAI,CAAC,UAAD,IAAe,CAAC,UAAU,CAAC,IAAI,CAAC,IAAN,EAAY,IAAZ,CAA9B,EAAiD;AAC/C,QAAA,IAAI,CAAC,IAAL,GAAY,IAAZ;AACA,QAAA,WAAW;AACZ;AACF,KANK,CADY,CAApB;AASA,WAAO,MAAK;AACV,MAAA,WAAW,CAAC,IAAZ;AACD,KAFD;AAGD,GAbQ,EAaN,IAbM,CAAT;AAeA,SAAO,IAAI,CAAC,IAAZ;AACD,CAvCD;;AA2CA,SAAS,gBAAT,CAAoC,UAApC,EAA+I;AAAA,MAA/E,IAA+E,uEAAvC,IAAuC;AAAA,MAAjC,UAAiC,uEAAJ,IAAI;;AAC7I,MAAI,IAAI,KAAK,IAAT,IAAiB,IAAI,KAAK,SAA1B,IAAuC,CAAC,KAAK,CAAC,OAAN,CAAc,IAAd,CAA5C,EAAiE;AAC/D,QAAI,OAAO,IAAP,KAAgB,UAApB,EAAgC;AAC9B,MAAA,UAAU,GAAG,IAAb;AACD;;AACD,WAAO,gBAAgB,CAAC,UAAD,EAAa,UAAb,CAAvB;AACD,GALD,MAKO;AACL,WAAO,kBAAkB,CAAC,UAAD,EAAa,IAAb,EAAmB,UAAnB,CAAzB;AACD;AACF;;AAED,MAAM,gBAAgB,GAA6B,UAAD,IAAe;AAC/D,SAAO,OAAO,CAAC,WAAR,CAAoB,UAApB,CAAP;AACD,CAFD,C,CAIA;AACA;;;AACA,MAAM,UAAU,GAAG,MAAM,CAAC,QAAP,GACf,gBADe,GAEf,gBAFJ;;AAIA,SAAS,aAAT,CAAwB,UAAxB,EAAkE;AAAA,MAA9B,IAA8B,uEAAvB,IAAuB;AAAA,MAAjB,UAAiB,uEAAJ,IAAI;;AAChE,WAAS,IAAT,CAAe,OAAf,EAAgC,GAAhC,EAA6C,GAA7C,EAA0D,IAA1D,EAAsE;AACpE,IAAA,OAAO,CAAC,IAAR,CACE,yCAAkC,OAAlC,sBAAsD,GAAtD,6BACQ,GADR,iCACmC,IADnC,OADF;AAID;;AAED,MAAI,OAAO,UAAP,KAAsB,UAA1B,EAAsC;AACpC,IAAA,IAAI,CAAC,UAAD,EAAa,KAAb,EAAoB,YAApB,EAAkC,UAAlC,CAAJ;AACD;;AAED,MAAI,IAAI,IAAI,UAAR,IAAsB,CAAC,KAAK,CAAC,OAAN,CAAc,IAAd,CAAvB,IAA8C,OAAO,UAAP,KAAsB,UAAxE,EAAoF;AAClF,IAAA,IAAI,CAAC,kBAAD,EAAqB,aAArB,EAAoC,kBAApC,YACC,OAAO,IADR,gBACkB,OAAO,UADzB,EAAJ;AAED,GAHD,MAGO;AACL,QAAI,IAAI,IAAI,CAAC,KAAK,CAAC,OAAN,CAAc,IAAd,CAAT,IAAgC,OAAO,IAAP,KAAgB,UAApD,EAAgE;AAC9D,MAAA,IAAI,CAAC,mBAAD,EAAsB,KAAtB,EAA6B,oBAA7B,EAAmD,OAAO,IAA1D,CAAJ;AACD;;AACD,QAAI,UAAU,IAAI,OAAO,UAAP,KAAsB,UAAxC,EAAoD;AAClD,MAAA,IAAI,CAAC,UAAD,EAAa,KAAb,EAAoB,YAApB,EAAkC,OAAO,UAAzC,CAAJ;AACD;AACF;;AAED,QAAM,IAAI,GAAG,UAAU,CAAC,UAAD,EAAa,IAAb,EAAmB,UAAnB,CAAvB;AACA,EAAA,WAAW,CAAC,IAAD,CAAX;AACA,SAAO,IAAP;AACD;;AA9MD,MAAA,CAAO,aAAP,CAgNe,MAAM,CAAC,aAAP,GACX,aADW,GAEX,UAlNJ","sourcesContent":["declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo, DependencyList } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor (data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nexport interface IReactiveFn<T> {\n  <T>(c?: Tracker.Computation): T\n}\n\nexport interface ISkipUpdate<T> {\n  <T>(prev: T, next: T): boolean\n}\n\ntype TrackerRefs = {\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  trackerData: any;\n}\n\nconst useTrackerNoDeps = <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate: ISkipUpdate<T> = null) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = reactiveFn(c);\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, reactiveFn(c))) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  }));\n\n  // To avoid creating side effects in render with Tracker when not using deps\n  // create the computation, run the user's reactive function in a computation synchronously,\n  // then immediately dispose of it. It'll be recreated again after the render is committed.\n  if (!refs.isMounted) {\n    // We want to forceUpdate in useEffect to support StrictMode.\n    // See: https://github.com/meteor/react-packages/issues/278\n    if (refs.computation) {\n      refs.computation.stop();\n      delete refs.computation;\n    }\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    // Render is committed. Since useTracker without deps always runs synchronously,\n    // forceUpdate and let the next render recreate the computation.\n    if (!skipUpdate) {\n      forceUpdate();\n    } else {\n      Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n        refs.computation = c;\n        if (!skipUpdate(refs.trackerData, reactiveFn(c))) {\n          // For any reactive change, forceUpdate and let the next render rebuild the computation.\n          forceUpdate();\n        }\n      }));\n    }\n\n    // stop the computation on unmount\n    return () =>{\n      refs.computation?.stop();\n    }\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps = <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList, skipUpdate: ISkipUpdate<T> = null): T => {\n  const forceUpdate = useForceUpdate();\n\n  const { current: refs } = useRef<{\n    reactiveFn: IReactiveFn<T>;\n    data?: T;\n  }>({ reactiveFn });\n\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(\n      () => Tracker.autorun((c: Tracker.Computation) => {\n        refs.data = refs.reactiveFn();\n      })\n    );\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(() => { comp.stop() });\n  }, deps);\n\n  useEffect(() => {\n    const computation = Tracker.nonreactive(\n      () => Tracker.autorun((c) => {\n        const data: T = refs.reactiveFn(c);\n        if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      })\n    );\n    return () => {\n      computation.stop();\n    };\n  }, deps);\n\n  return refs.data as T;\n};\n\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps?: DependencyList, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList | ISkipUpdate<T> = null, skipUpdate: ISkipUpdate<T> = null): T {\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer: typeof useTrackerClient = (reactiveFn) => {\n  return Tracker.nonreactive(reactiveFn);\n}\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nfunction useTrackerDev (reactiveFn, deps = null, skipUpdate = null) {\n  function warn (expects: string, pos: string, arg: string, type: string) {\n    console.warn(\n      `Warning: useTracker expected a ${expects} in it\\'s ${pos} argument `\n        + `(${arg}), but got type of \\`${type}\\`.`\n    );\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\",\n      `${typeof deps} & ${typeof skipUpdate}`);\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nexport default Meteor.isDevelopment\n  ? useTrackerDev as typeof useTrackerClient\n  : useTracker;\n"],"sourceRoot":""},"sourceType":"module","hash":"c14738b74caeac9c12a38bccd71593f2f37399a0"}
